<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KARAAGE EATER</title>
    <style>
        html, body { position: fixed; width: 100%; height: 100%; overflow: hidden; touch-action: none; }
        body { 
            margin: 0; padding: 0; text-align: center; 
            background-color: #d2b48c;
            background-image: linear-gradient(45deg, #deb887 25%, transparent 25%, transparent 75%, #deb887 75%, #deb887), linear-gradient(45deg, #deb887 25%, transparent 25%, transparent 75%, #deb887 75%, #deb887);
            background-size: 60px 60px; background-position: 0 0, 30px 30px;
            font-family: 'Arial Black', sans-serif;
        }
        #header { width: 100%; height: 50px; background: #222; color: #fff; display: flex; align-items: center; justify-content: center; position: fixed; top: 0; z-index: 100; font-size: 20px; }
        #info-bar { position: fixed; top: 55px; width: 100%; z-index: 100; display: flex; justify-content: space-around; font-size: 16px; color: #5d4037; font-weight: bold; background: rgba(255,255,255,0.4); }
        
        #char { font-size: 60px; position: absolute; z-index: 10; transform: translate(-50%, -50%); pointer-events: none; display: none; }
        .food { font-size: 45px; position: absolute; transform: translate(-50%, -50%); display: none; }
        #clock-item { font-size: 40px; position: absolute; transform: translate(-50%, -50%); display: none; z-index: 15; }

        /* Êìç‰ΩúUI */
        #joystick-area { position: fixed; bottom: 30px; left: 30px; width: 120px; height: 120px; background: rgba(0,0,0,0.2); border-radius: 50%; z-index: 200; display: none; }
        #joystick-stick { position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; background: #333; border-radius: 50%; transform: translate(-50%, -50%); }
        #action-btn-area { position: fixed; bottom: 35px; right: 25px; z-index: 200; display: none; }
        #btn { width: 110px; height: 110px; background: #D2691E; color: white; border-radius: 50%; border: 5px solid #fff; font-size: 18px; font-weight: bold; box-shadow: 0 6px #5d4037; }

        /* „Ç™„Éº„Éê„Éº„É¨„Ç§ÂÖ±ÈÄö */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 300; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .level-btn { width: 220px; padding: 12px; margin: 8px; font-size: 20px; border-radius: 8px; border: none; font-weight: bold; }
        .lv-komori { background: #4CAF50; color: white; }
        .lv-namimori { background: #FFC107; color: #000; }
        .lv-oomori { background: #FF5722; color: white; }
        .lv-tokumori { background: #9C27B0; color: white; display: none; }
        
        #ready-count { font-size: 120px; color: #FF4500; }
        #hint-text { font-size: 18px; color: #FFD700; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="header">KARAAGE EATER</div>
    <div id="info-bar">
        <div id="timer-ui">TIME: 30</div>
        <div id="count-ui">EAT: 0/10</div>
    </div>

    <div id="karaage" class="food">üçó</div>
    <div id="spicy" class="food">üå∂Ô∏è</div>
    <div id="big-karaage" class="food">üçñ</div>
    <div id="clock-item">‚è∞</div>
    <div id="char">üòé</div>
    
    <div id="joystick-area"><div id="joystick-stick"></div></div>
    <div id="action-btn-area"><button id="btn">È£ü„Åπ„ÇãÔºÅ</button></div>

    <div id="overlay">
        <h1 id="overlay-title">SELECT MENU</h1>
        <div id="hint-text"></div>
        <div id="ready-count" style="display:none">5</div>
        <div id="menu-list">
            <button class="level-btn lv-komori" onclick="selectLevel('Â∞èÁõõ')">Â∞èÁõõ (10ÂÄã)</button>
            <button class="level-btn lv-namimori" onclick="selectLevel('‰∏¶Áõõ')">‰∏¶Áõõ (12ÂÄã)</button>
            <button class="level-btn lv-oomori" onclick="selectLevel('Â§ßÁõõ')">Â§ßÁõõ (15ÂÄã)</button>
            <button id="tokumori-btn" class="level-btn lv-tokumori" onclick="selectLevel('ÁâπÁõõ')">ÁâπÁõõ (20ÂÄã)</button>
        </div>
        <button id="retry-btn" class="level-btn" style="display:none; background:#555; color:white;" onclick="showMenu()">MENU„Å´Êàª„Çã</button>
    </div>

    <script>
        let fullness = 0, targetFullness = 10, timeLeft = 30;
        let gameState = "MENU", currentLevel = "";
        let pX, pY, kX, kY, sx, sy, bx, by, cx, cy;
        let joyX = 0, joyY = 0, isMoving = false, isStunned = false;
        let timerId = null, bigTapCount = 0, tokumoriUnlocked = false;
        let spicyChance = 0, spicyLeft = 0, bigLeft = 0, clockUsed = false;

        const char = document.getElementById('char');
        const items = { k: document.getElementById('karaage'), s: document.getElementById('spicy'), b: document.getElementById('big-karaage'), c: document.getElementById('clock-item') };
        const ui = { timer: document.getElementById('timer-ui'), count: document.getElementById('count-ui'), overlay: document.getElementById('overlay'), hint: document.getElementById('hint-text'), title: document.getElementById('overlay-title'), countDisp: document.getElementById('ready-count'), menuList: document.getElementById('menu-list'), retryBtn: document.getElementById('retry-btn'), tokumori: document.getElementById('tokumori-btn') };

        function showMenu() {
            gameState = "MENU";
            ui.overlay.style.display = "flex";
            ui.title.style.display = "block"; ui.title.innerText = "SELECT MENU";
            ui.menuList.style.display = "block";
            ui.hint.innerText = "";
            ui.countDisp.style.display = "none";
            ui.retryBtn.style.display = "none";
            if(tokumoriUnlocked) ui.tokumori.style.display = "block";
        }

        function selectLevel(lv) {
            currentLevel = lv;
            ui.menuList.style.display = "none";
            ui.title.innerText = lv;
            
            const hints = {
                'Â∞èÁõõ': 'ÂÆåÈ£ü„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ',
                '‰∏¶Áõõ': 'ÈñìÈÅï„Å£„Å¶ÂîêËæõÂ≠ê„ÅØÈ£ü„Åπ„Å™„ÅÑ„Åß„Å≠ÔºÅ',
                'Â§ßÁõõ': 'ËÇâÂéö„Å™„ÅäËÇâ„ÅØ„Åü„Åè„Åï„ÇìÂöô„ÇÇ„ÅÜÔºÅÔºàÈÄ£ÊâìÔºâ',
                'ÁâπÁõõ': 'È≠îÊ≥ï„ÅÆÊôÇË®à„Çí‰Ωø„ÅÜ„Çì„Å†ÔºÅ'
            };
            ui.hint.innerText = hints[lv];
            
            // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥
            ui.countDisp.style.display = "block";
            let c = 5;
            ui.countDisp.innerText = c;
            let ci = setInterval(() => {
                c--;
                ui.countDisp.innerText = c;
                if(c <= 0) {
                    clearInterval(ci);
                    startGame(lv);
                }
            }, 1000);
        }

        function startGame(lv) {
            fullness = 0; timeLeft = 30; isStunned = false; clockUsed = false;
            pX = window.innerWidth / 2; pY = window.innerHeight / 2;
            
            if(lv==='Â∞èÁõõ'){ targetFullness=10; spicyChance=0; bigLeft=0; }
            if(lv==='‰∏¶Áõõ'){ targetFullness=12; spicyChance=3; bigLeft=0; }
            if(lv==='Â§ßÁõõ'){ targetFullness=15; spicyChance=5; bigLeft=2; }
            if(lv==='ÁâπÁõõ'){ targetFullness=20; spicyChance=5; bigLeft=3; }
            
            spicyLeft = spicyChance;
            ui.count.innerText = `EAT: 0/${targetFullness}`;
            ui.overlay.style.display = "none";
            char.style.display = "block"; char.innerText = "üòé";
            document.getElementById('joystick-area').style.display = "block";
            document.getElementById('action-btn-area').style.display = "block";
            
            spawnFood();
            gameState = "PLAYING";
            startTimer();
        }

        function spawnFood() {
            Object.values(items).forEach(i => i.style.display = "none");
            
            // ÁâπÂ§ß„ÅåÂá∫„Çã„ÅãÂà§ÂÆöÔºàÂ§ßÁõõ„ÉªÁâπÁõõ„ÅÆ„ÅøÔºâ
            let bigAppears = false;
            if(bigLeft > 0 && fullness >= 3 && Math.random() < 0.35) {
                bx = Math.random()*(window.innerWidth-100)+50; by = Math.random()*(window.innerHeight-300)+150;
                items.b.style.left = bx+"px"; items.b.style.top = by+"px"; items.b.style.display = "block";
                bigTapCount = 5;
                bigAppears = true;
            }

            // ÁâπÂ§ß„ÅåÂá∫„Å™„ÅÑÊôÇ„Å†„ÅëÊôÆÈÄö„ÅÆ„ÇíÂá∫„Åô
            if(!bigAppears) {
                kX = Math.random()*(window.innerWidth-100)+50; kY = Math.random()*(window.innerHeight-300)+150;
                items.k.style.left = kX+"px"; items.k.style.top = kY+"px"; items.k.style.display = "block";
            }
            
            // ÊøÄËæõ„ÅØÁâπÂ§ß„Åå„ÅÑ„Å¶„ÇÇ„ÅÑ„Å™„Åè„Å¶„ÇÇÂá∫„Çã
            if(spicyLeft > 0 && Math.random() < 0.45) {
                sx = Math.random()*(window.innerWidth-100)+50; sy = Math.random()*(window.innerHeight-300)+150;
                items.s.style.left = sx+"px"; items.s.style.top = sy+"px"; items.s.style.display = "block";
                spicyLeft--;
            }
        }

        function startTimer() {
            if(timerId) clearInterval(timerId);
            timerId = setInterval(() => {
                if(gameState !== "PLAYING") return;
                timeLeft--;
                if(currentLevel === "ÁâπÁõõ" && timeLeft === 15 && !clockUsed) {
                    cx = Math.random()*(window.innerWidth-100)+50; cy = Math.random()*(window.innerHeight-300)+150;
                    items.c.style.left = cx+"px"; items.c.style.top = cy+"px"; items.c.style.display = "block";
                    setTimeout(() => { items.c.style.display = "none"; }, 5000);
                }
                ui.timer.innerText = `TIME: ${timeLeft}`;
                if(timeLeft <= 0) endGame(false);
            }, 1000);
        }

        function endGame(isWin) {
            gameState = "FINISH";
            clearInterval(timerId);
            ui.overlay.style.display = "flex";
            ui.countDisp.style.display = "none";
            ui.retryBtn.style.display = "block";
            if(isWin) {
                ui.title.innerText = "CLEAR!";
                ui.hint.innerText = `${currentLevel} ÂÆåÈ£üÔºÅ„ÅäË¶ã‰∫ãÔºÅ`;
                if(currentLevel === "Â§ßÁõõ") tokumoriUnlocked = true;
            } else {
                ui.title.innerText = "GAME OVER";
                ui.hint.innerText = "ÊôÇÈñìÂàá„Çå„Å†ÔºÅ„É™„Éô„É≥„Ç∏„Åó„Çà„ÅÜ„ÄÇ";
            }
        }

        // „Çπ„ÉÜ„Ç£„ÉÉ„ÇØÊìç‰Ωú
        const joyArea = document.getElementById('joystick-area');
        const stick = document.getElementById('joystick-stick');
        joyArea.addEventListener('touchstart', (e) => { isMoving = true; });
        joyArea.addEventListener('touchmove', (e) => {
            const t = e.touches[0]; const r = joyArea.getBoundingClientRect();
            const dx = t.clientX - (r.left + 60), dy = t.clientY - (r.top + 60);
            const dist = Math.min(Math.hypot(dx, dy), 50); const ang = Math.atan2(dy, dx);
            joyX = Math.cos(ang) * dist / 50; joyY = Math.sin(ang) * dist / 50;
            stick.style.left = (50 + joyX * 40) + "%"; stick.style.top = (50 + joyY * 40) + "%";
        });
        window.addEventListener('touchend', () => { isMoving = false; joyX = 0; joyY = 0; stick.style.left = "50%"; stick.style.top = "50%"; });

        function gameLoop() {
            if (gameState === "PLAYING" && isMoving && !isStunned) {
                pX += joyX * 6; pY += joyY * 6;
                pX = Math.max(30, Math.min(window.innerWidth - 30, pX));
                pY = Math.max(100, Math.min(window.innerHeight - 150, pY));
            }
            char.style.left = pX + "px"; char.style.top = pY + "px";
            requestAnimationFrame(gameLoop);
        }
        gameLoop();

        document.getElementById('btn').onclick = () => {
            if(gameState !== "PLAYING" || isStunned) return;
            if(items.c.style.display === "block" && Math.hypot(pX-cx, pY-cy) < 80) {
                timeLeft += 10; clockUsed = true; items.c.style.display = "none"; return;
            }
            if(items.s.style.display === "block" && Math.hypot(pX-sx, pY-sy) < 80) {
                isStunned = true; char.innerText = "üò≠"; items.s.style.display = "none";
                setTimeout(() => { isStunned = false; char.innerText = "üòé"; }, 3000); return;
            }
            if(items.b.style.display === "block" && Math.hypot(pX-bx, pY-by) < 80) {
                bigTapCount--; char.innerText = "üò≤";
                if(bigTapCount <= 0) { 
                    fullness++; bigLeft--; items.b.style.display = "none"; checkWin(); spawnFood(); 
                }
                return;
            }
            if(items.k.style.display === "block" && Math.hypot(pX-kX, pY-kY) < 90) {
                fullness++; char.innerText = "üòã"; items.k.style.display = "none";
                checkWin(); setTimeout(() => { if(gameState==="PLAYING") { char.innerText="üòé"; spawnFood(); } }, 200);
            }
        };

        function checkWin() {
            ui.count.innerText = `EAT: ${fullness}/${targetFullness}`;
            if(fullness >= targetFullness) endGame(true);
        }
    </script>
</body>
</html>