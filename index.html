<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KARAAGE EATER</title>
    <style>
        /* ç”»é¢å›ºå®šã®åˆ¶å¾¡ */
        html, body { 
            position: fixed; width: 100%; height: 100%; overflow: hidden; 
            touch-action: none; -webkit-overflow-scrolling: none;
        }
        body { 
            margin: 0; padding: 0; text-align: center; 
            background-color: #d2b48c;
            background-image: linear-gradient(45deg, #deb887 25%, transparent 25%, transparent 75%, #deb887 75%, #deb887), linear-gradient(45deg, #deb887 25%, transparent 25%, transparent 75%, #deb887 75%, #deb887);
            background-size: 60px 60px; background-position: 0 0, 30px 30px;
            font-family: 'Arial Black', sans-serif;
        }
        #header { width: 100%; height: 50px; background: #222; color: #fff; display: flex; align-items: center; justify-content: center; position: fixed; top: 0; z-index: 100; font-size: 20px; }
        #info-bar { position: fixed; top: 55px; width: 100%; z-index: 100; display: flex; justify-content: space-around; font-size: 16px; color: #5d4037; font-weight: bold; background: rgba(255,255,255,0.3); }
        
        /* ã‚­ãƒ£ãƒ©ãƒ»ã‚¢ã‚¤ãƒ†ãƒ  */
        #char { font-size: 60px; position: absolute; z-index: 10; transform: translate(-50%, -50%); pointer-events: none; display: none; }
        .food { font-size: 45px; position: absolute; transform: translate(-50%, -50%); display: none; }
        #clock-item { font-size: 40px; position: absolute; transform: translate(-50%, -50%); display: none; z-index: 15; }

        /* UI */
        #joystick-area { position: fixed; bottom: 30px; left: 30px; width: 120px; height: 120px; background: rgba(0,0,0,0.2); border-radius: 50%; z-index: 200; display: none; }
        #joystick-stick { position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; background: #333; border-radius: 50%; transform: translate(-50%, -50%); }
        #action-btn-area { position: fixed; bottom: 35px; right: 25px; z-index: 200; display: none; }
        #btn { width: 110px; height: 110px; background: #D2691E; color: white; border-radius: 50%; border: 5px solid #fff; font-size: 18px; font-weight: bold; box-shadow: 0 6px #5d4037; }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 300; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .level-btn { width: 200px; padding: 12px; margin: 8px; font-size: 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .lv-komori { background: #4CAF50; color: white; }
        .lv-namimori { background: #FFC107; color: #000; }
        .lv-oomori { background: #FF5722; color: white; }
        .lv-tokumori { background: #9C27B0; color: white; display: none; }
    </style>
</head>
<body>
    <div id="header">KARAAGE EATER</div>
    <div id="info-bar">
        <div id="timer-ui">TIME: 30</div>
        <div id="count-ui">EAT: 0/10</div>
    </div>

    <div id="karaage" class="food">ğŸ—</div>
    <div id="spicy" class="food">ğŸŒ¶ï¸</div>
    <div id="big-karaage" class="food">ğŸ–</div>
    <div id="clock-item">â°</div>
    <div id="char">ğŸ˜</div>
    
    <div id="joystick-area"><div id="joystick-stick"></div></div>
    <div id="action-btn-area"><button id="btn">é£Ÿã¹ã‚‹ï¼</button></div>

    <div id="overlay">
        <h1 id="overlay-title">SELECT MENU</h1>
        <div id="menu-list">
            <button class="level-btn lv-komori" onclick="initGame('å°ç››')">å°ç›› (10å€‹)</button>
            <button class="level-btn lv-namimori" onclick="initGame('ä¸¦ç››')">ä¸¦ç›› (12å€‹)</button>
            <button class="level-btn lv-oomori" onclick="initGame('å¤§ç››')">å¤§ç›› (15å€‹)</button>
            <button id="tokumori-btn" class="level-btn lv-tokumori" onclick="initGame('ç‰¹ç››')">ç‰¹ç›› (20å€‹)</button>
        </div>
        <p id="overlay-msg" style="margin-top:20px; font-size:14px;"></p>
    </div>

    <script>
        let fullness = 0, targetFullness = 10, timeLeft = 30;
        let gameState = "MENU", currentLevel = "";
        let pX, pY, kX, kY, sx, sy, bx, by, cx, cy;
        let joyX = 0, joyY = 0, isMoving = false, isStunned = false;
        let timerId = null, bigTapCount = 0, tokumoriUnlocked = false;
        let spicyChance = 0, spicyLeft = 0, bigLeft = 0, clockUsed = false;

        const char = document.getElementById('char');
        const items = { k: document.getElementById('karaage'), s: document.getElementById('spicy'), b: document.getElementById('big-karaage'), c: document.getElementById('clock-item') };
        const ui = { timer: document.getElementById('timer-ui'), count: document.getElementById('count-ui'), overlay: document.getElementById('overlay'), msg: document.getElementById('overlay-msg'), title: document.getElementById('overlay-title'), tokumori: document.getElementById('tokumori-btn') };

        function initGame(lv) {
            currentLevel = lv;
            fullness = 0; timeLeft = 30; isStunned = false; clockUsed = false;
            pX = window.innerWidth / 2; pY = window.innerHeight / 2;
            
            if(lv==='å°ç››'){ targetFullness=10; spicyChance=0; bigLeft=0; }
            if(lv==='ä¸¦ç››'){ targetFullness=12; spicyChance=3; bigLeft=0; }
            if(lv==='å¤§ç››'){ targetFullness=15; spicyChance=5; bigLeft=2; }
            if(lv==='ç‰¹ç››'){ targetFullness=20; spicyChance=5; bigLeft=3; }
            
            spicyLeft = spicyChance;
            ui.count.innerText = `EAT: 0/${targetFullness}`;
            ui.overlay.style.display = "none";
            char.style.display = "block"; char.innerText = "ğŸ˜";
            document.getElementById('joystick-area').style.display = "block";
            document.getElementById('action-btn-area').style.display = "block";
            
            spawnFood();
            gameState = "PLAYING";
            startTimer();
        }

        function spawnFood() {
            Object.values(items).forEach(i => i.style.display = "none");
            // é€šå¸¸å”æšã’
            kX = Math.random()*(window.innerWidth-100)+50; kY = Math.random()*(window.innerHeight-300)+150;
            items.k.style.left = kX+"px"; items.k.style.top = kY+"px"; items.k.style.display = "block";
            
            // æ¿€è¾›ï¼ˆãƒ©ãƒ³ãƒ€ãƒ å‡ºç¾ï¼‰
            if(spicyLeft > 0 && Math.random() < 0.4) {
                sx = Math.random()*(window.innerWidth-100)+50; sy = Math.random()*(window.innerHeight-300)+150;
                items.s.style.left = sx+"px"; items.s.style.top = sy+"px"; items.s.style.display = "block";
                spicyLeft--;
            }
            // ç‰¹å¤§ï¼ˆãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸå›æ•°ï¼‰
            if(bigLeft > 0 && fullness >= 3 && Math.random() < 0.3) {
                bx = Math.random()*(window.innerWidth-100)+50; by = Math.random()*(window.innerHeight-300)+150;
                items.b.style.left = bx+"px"; items.b.style.top = by+"px"; items.b.style.display = "block";
                bigTapCount = 5;
            }
        }

        function startTimer() {
            if(timerId) clearInterval(timerId);
            timerId = setInterval(() => {
                if(gameState !== "PLAYING") return;
                timeLeft--;
                // ç‰¹ç››æ™‚è¨ˆã‚¤ãƒ™ãƒ³ãƒˆ
                if(currentLevel === "ç‰¹ç››" && timeLeft === 15 && !clockUsed) {
                    cx = Math.random()*(window.innerWidth-100)+50; cy = Math.random()*(window.innerHeight-300)+150;
                    items.c.style.left = cx+"px"; items.c.style.top = cy+"px"; items.c.style.display = "block";
                    setTimeout(() => { items.c.style.display = "none"; }, 5000);
                }
                ui.timer.innerText = `TIME: ${timeLeft}`;
                if(timeLeft <= 0) endGame(false);
            }, 1000);
        }

        function endGame(isWin) {
            gameState = "MENU";
            clearInterval(timerId);
            ui.overlay.style.display = "flex";
            if(isWin) {
                ui.title.innerText = "CLEAR!";
                ui.msg.innerText = `${currentLevel} å®Œé£Ÿï¼ãŠè¦‹äº‹ï¼`;
                if(currentLevel === "å¤§ç››") { tokumoriUnlocked = true; ui.tokumori.style.display = "block"; }
            } else {
                ui.title.innerText = "GAME OVER";
                ui.msg.innerText = "æ™‚é–“åˆ‡ã‚Œã ï¼ãƒªãƒ™ãƒ³ã‚¸ã—ã‚ˆã†ã€‚";
            }
        }

        // ç§»å‹•
        const joyArea = document.getElementById('joystick-area');
        const stick = document.getElementById('joystick-stick');
        joyArea.addEventListener('touchstart', (e) => { isMoving = true; });
        joyArea.addEventListener('touchmove', (e) => {
            const t = e.touches[0]; const r = joyArea.getBoundingClientRect();
            const dx = t.clientX - (r.left + 60), dy = t.clientY - (r.top + 60);
            const dist = Math.min(Math.hypot(dx, dy), 50); const ang = Math.atan2(dy, dx);
            joyX = Math.cos(ang) * dist / 50; joyY = Math.sin(ang) * dist / 50;
            stick.style.left = (50 + joyX * 40) + "%"; stick.style.top = (50 + joyY * 40) + "%";
        });
        window.addEventListener('touchend', () => { isMoving = false; joyX = 0; joyY = 0; stick.style.left = "50%"; stick.style.top = "50%"; });

        function gameLoop() {
            if (gameState === "PLAYING" && isMoving && !isStunned) {
                pX += joyX * 6; pY += joyY * 6;
                pX = Math.max(30, Math.min(window.innerWidth - 30, pX));
                pY = Math.max(100, Math.min(window.innerHeight - 150, pY));
            }
            char.style.left = pX + "px"; char.style.top = pY + "px";
            requestAnimationFrame(gameLoop);
        }
        gameLoop();

        document.getElementById('btn').onclick = () => {
            if(gameState !== "PLAYING" || isStunned) return;
            // æ™‚è¨ˆåˆ¤å®š
            if(items.c.style.display === "block" && Math.hypot(pX-cx, pY-cy) < 80) {
                timeLeft += 10; clockUsed = true; items.c.style.display = "none"; return;
            }
            // æ¿€è¾›åˆ¤å®š
            if(items.s.style.display === "block" && Math.hypot(pX-sx, pY-sy) < 80) {
                isStunned = true; char.innerText = "ğŸ˜­"; items.s.style.display = "none";
                setTimeout(() => { isStunned = false; char.innerText = "ğŸ˜"; }, 3000); return;
            }
            // ç‰¹å¤§åˆ¤å®š
            if(items.b.style.display === "block" && Math.hypot(pX-bx, pY-by) < 80) {
                bigTapCount--; char.innerText = "ğŸ˜²";
                if(bigTapCount <= 0) { 
                    fullness++; bigLeft--; items.b.style.display = "none"; checkWin(); spawnFood(); 
                }
                return;
            }
            // é€šå¸¸åˆ¤å®š
            if(Math.hypot(pX-kX, pY-kY) < 90) {
                fullness++; char.innerText = "ğŸ˜‹"; items.k.style.display = "none";
                checkWin(); setTimeout(() => { if(gameState==="PLAYING") { char.innerText="ğŸ˜"; spawnFood(); } }, 200);
            }
        };

        function checkWin() {
            ui.count.innerText = `EAT: ${fullness}/${targetFullness}`;
            if(fullness >= targetFullness) endGame(true);
        }
    </script>
</body>
</html>